name: Release

on:
  push:
    branches:
      - master

jobs:
  build-publish-latest:
    runs-on: ubuntu-latest
    steps:
      - name: checkout tyk-operator
        uses: actions/checkout@v2
#      - name: create kind cluster
#        uses: helm/kind-action@v1.0.0
#      - name: install kubebuilder
#        uses: RyanSiu1995/kubebuilder-action@v1
      - name: build-push
        run: |
          echo "DOCKER_USERNAME: ${{secrets.DOCKER_USERNAME}}"
          echo "DOCKER_PASSWORD: ${{secrets.DOCKER_PASSWORD}}"
          echo -n ${{secrets.DOCKER_PASSWORD}} | docker login --username ${{secrets.DOCKER_USERNAME}} --password-stdin
          export USERNAME=tykio
          make docker-build-notest IMG=${USERNAME}/tyk-operator:latest
          make docker-push IMG=${USERNAME}/tyk-operator:latest
